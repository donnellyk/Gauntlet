<!DOCTYPE html>
<html lang="en">
  <head>
    <title>StateMachine Class Reference</title>
    <link rel="stylesheet" type="text/css" href="../css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="../css/highlight.css" />
    <meta charset='utf-8'>
    <script src="../js/jquery.min.js" defer></script>
    <script src="../js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a name="//apple_ref/swift/Class/StateMachine" class="dashAnchor"></a>
    <a title="StateMachine Class Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="../index.html">Gauntlet Docs</a> (100% documented)</p>
        <p class="header-right"><a href="https://github.com/jemmons/Gauntlet"><img src="../img/gh.png"/>View on GitHub</a></p>
        <p class="header-right"><a href="dash-feed://https%3A%2F%2Fjemmons%2Egithub%2Eio%2FGauntlet%2Fdocsets%2FGauntlet%2Exml"><img src="../img/dash.png"/>Install in Dash</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="../index.html">Gauntlet Reference</a>
        <img id="carat" src="../img/carat.png" />
        StateMachine Class Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="../Public Interface.html">Public Interface</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Protocols/Transitionable.html">Transitionable</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/StateMachine.html">StateMachine</a>
              </li>
              <li class="nav-group-task">
                <a href="../Classes/StateMachine/StateTransitionDelegates.html">– StateTransitionDelegates</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Constants.html">Constants</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Enums/GauntletNotification.html">GauntletNotification</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="../Other Typealiases.html">Other Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="../Other Typealiases.html#/s:8Gauntlet9StateTypea">StateType</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            <h1>StateMachine</h1>
              <div class="declaration">
                <div class="language">
                  <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">class</span> <span class="kt">StateMachine</span><span class="o">&lt;</span><span class="kt">State</span><span class="o">&gt;</span> <span class="k">where</span> <span class="kt">State</span> <span class="p">:</span> <span class="kt"><a href="../Protocols/Transitionable.html">Transitionable</a></span></code></pre>

                </div>
              </div>
            <p>On Testing:</p>

<p>Often when testing, we&rsquo;ll want to assert that a state machine has made some transition. Because state machines should be private implementation details of their classes, and becasue state change happens asynchronously (or, at least, in the next cycle of the runloop), this can be difficult without sprinkling completion handlers throughout our code.</p>

<p>Instead, we can define the environment variable <code>GAUNTLET_POST_TEST_NOTIFICATIONS</code> in our testing scheme (any non-nil value will do), and subscribe to one or more of the following notification names:</p>

<ul>
<li><code><a href="../Enums/GauntletNotification.html#/s:8Gauntlet0A12NotificationO14willTransitionSo18NSNotificationNameavpZ">GauntletNotification.willTransition</a></code></li>
<li><code><a href="../Enums/GauntletNotification.html#/s:8Gauntlet0A12NotificationO13didTransitionSo18NSNotificationNameavpZ">GauntletNotification.didTransition</a></code></li>
</ul>

<p>Both will post a <code>userInfo</code> with the following values:</p>

<ul>
<li><code>from</code>: The <code><a href="../Other Typealiases.html#/s:8Gauntlet9StateTypea">StateType</a></code> the <code>StateMachine</code> did/will transition from.</li>
<li><code>to</code>: The <code><a href="../Other Typealiases.html#/s:8Gauntlet9StateTypea">StateType</a></code> the <code>StateMachine</code> did/will transition to.</li>
</ul>

          </section>
          <section class="section task-group-section">
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8Gauntlet12StateMachineC0B19TransitionDelegatesV"></a>
                    <a name="//apple_ref/swift/Struct/StateTransitionDelegates" class="dashAnchor"></a>
                    <a class="token" href="#/s:8Gauntlet12StateMachineC0B19TransitionDelegatesV">StateTransitionDelegates</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Delegate tasks of <code><a href="../Classes/StateMachine.html">StateMachine</a></code>. Consumers can assign implementations to respond to lifecycle events.</p>

                        <a href="../Classes/StateMachine/StateTransitionDelegates.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">struct</span> <span class="kt">StateTransitionDelegates</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8Gauntlet12StateMachineC9delegatesAC0B19TransitionDelegatesVyx_Gvp"></a>
                    <a name="//apple_ref/swift/Property/delegates" class="dashAnchor"></a>
                    <a class="token" href="#/s:8Gauntlet12StateMachineC9delegatesAC0B19TransitionDelegatesVyx_Gvp">delegates</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Consumers can assign implementations to protperties of <code>delegates</code> to respond to lifecycle events.</p>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    <p>Why assign a closure for delegated functionality instead of the more standard “set a reference to a class that conforms to a delegate protocol”? Because it’s important the states passed to the delegate method have the same type as <code>State</code> (relative to the <code>StateMachine</code> class).</p>

<p>To do this with a protocol is a bit of a mess because it involves associated types. This has gotten better with conditional conformance, but we still have to make it a top-level generic type, and that’s still ugly (it requrires we give a delegate type even if we don’t use one, it can’t infer the type if we don’t add the delegate as an initialization parameter, etc).</p>

</div>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="k">var</span> <span class="nv">delegates</span><span class="p">:</span> <span class="kt">StateMachine</span><span class="o">&lt;</span><span class="kt">State</span><span class="o">&gt;.</span><span class="kt"><a href="../Classes/StateMachine/StateTransitionDelegates.html">StateTransitionDelegates</a></span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8Gauntlet12StateMachineC5statexvp"></a>
                    <a name="//apple_ref/swift/Property/state" class="dashAnchor"></a>
                    <a class="token" href="#/s:8Gauntlet12StateMachineC5statexvp">state</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>The current state of the state machine. Read-only.</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">State</span> <span class="p">{</span>
  <span class="k">get</span>
  <span class="p">}</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8Gauntlet12StateMachineC07initialB0ACyxGx_tcfc"></a>
                    <a name="//apple_ref/swift/Method/init(initialState:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:8Gauntlet12StateMachineC07initialB0ACyxGx_tcfc">init(initialState:)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Initializes the state machine with the given initial state.</p>
<div class="aside aside-note">
    <p class="aside-title">Note</p>
    This could very easily also take a(n optional) <code>didTransition</code> handler, saving us a common assignment that will almost always take place directly after instantiation. But I&rsquo;m always forgetting whether <code>didTransition</code> is called when setting initial state or not. Keeping the assignment seperate makes the answer obvious.

</div>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="nf">init</span><span class="p">(</span><span class="nv">initialState</span><span class="p">:</span> <span class="kt">State</span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:8Gauntlet12StateMachineC5queueyyxF"></a>
                    <a name="//apple_ref/swift/Method/queue(_:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:8Gauntlet12StateMachineC5queueyyxF">queue(_:)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Use this method to transition states.</p>

<p>First, the validity of a transition to the given <code><a href="../Classes/StateMachine.html#/s:8Gauntlet12StateMachineC5statexvp">state</a></code> is determined via a call to its <code>shouldTransitionFrom(_,to:)</code>. If it is valid, the machine tranisitons to it, calling <code>didTransition(from:to:)</code> once complete. If not, the given <code><a href="../Classes/StateMachine.html#/s:8Gauntlet12StateMachineC5statexvp">state</a></code> is silently ignored.</p>
<div class="aside aside-attention">
    <p class="aside-title">Attention</p>
    <p>This method queues the state transition to happen on the next pass of the run loop. Thus, it&rsquo;s safe to call <code>queue(_)</code> from <code>didTransition(from:to:)</code> without concern for the stack. However, this also means that even calls to <code>queue(_)</code> with valid transition targets will not be reflected immediately in the state:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">machine</span> <span class="o">=</span> <span class="kt">StateMachine</span><span class="p">(</span><span class="nv">initialState</span><span class="p">:</span> <span class="kt">State</span><span class="o">.</span><span class="n">ready</span><span class="p">)</span>
<span class="n">machine</span><span class="o">.</span><span class="nf">queue</span><span class="p">(</span><span class="kt">State</span><span class="o">.</span><span class="n">fetch</span><span class="p">)</span>
<span class="n">machine</span><span class="o">.</span><span class="n">state</span> <span class="c1">//&gt; still `State.ready`</span>
</code></pre>

</div>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">func</span> <span class="nf">queue</span><span class="p">(</span><span class="n">_</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">State</span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>state</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>The state to transition to.</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </section>
        </section>
        <section id="footer">
          <p>&copy; 2019 <a class="link" href="https://figure.ink" target="_blank" rel="external">Joshua Emmons</a>. All rights reserved. (Last updated: 2019-08-08)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.5</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
